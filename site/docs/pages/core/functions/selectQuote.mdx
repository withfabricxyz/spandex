# selectQuote

Prepare a list of swap quote promise chains for quote fetching and secondary actions such as simulation. This is useful when custom behavior is required, such as racing quotes+simulation for multiple providers.

## Example

:::code-group

```ts [selectQuote]
import { selectQuote } from "@withfabric/spandex";
import { promises } from "./prepare.ts";

const quote = selectQuote({
  quotes: promises,
  strategy: "bestPrice",
});
```

```ts [prepare.ts] filename="prepare.ts"
import { prepareQuotes, type Quote } from "@withfabric/spandex";
import { config } from "./config.ts";

// Identity fn
async function mapFn(quote: Quote) => Promise<Quote> {
  return quote;
};

export const promises = prepareQuotes({
  config,
  swap: {
    chainId: 8453,
    inputToken: "0x4200000000000000000000000000000000000006", // WETH
    outputToken: "0xd9AAEC86B65D86f6A7B5B1b0c42FFA531710b6CA", // USDbC
    mode: "exactIn",
    inputAmount: 1_000_000_000_000_000_000n, // 1 WETH
    slippageBps: 50, // Tolerance
    swapperAccount: "0x1234567890abcdef1234567890abcdef12345678",
  },
  mapFn,
});
```

```ts [config.ts] filename="config.ts" twoslash
import { createConfig } from "@withfabric/spandex";
import { createPublicClient, http, type PublicClient } from "viem";
import { base } from "viem/chains";

const client = createPublicClient({
  chain: base,
  transport: http("https://base.drpc.org"),
});

export const config = createConfig({
  providers: {
    fabric: {},
    odos: {},
  },
  clients: [client] as PublicClient[],
});
```

:::

## Params

### quotes
`Promise<SimulatedQuote[]>`

A list of promises each resolving to a simulated quote. These can be created via the [`prepareQuotes`](./prepareQuotes.mdx) function.

### strategy
`QuoteSelectionStrategy`

Function that maps each fetched quote to a promise of type `T`. This allows for custom processing of each quote, such as simulation or other enrichment. Identity function is also valid.

| Strategy | Waits for All | Selection Criteria | Best For |
|----------|---------------|-------------------|----------|
| `quotedPrice` | ✓ | Highest output | Price optimization |
| `quotedGas` | ✓ | Lowest gas cost | Gas efficiency |
| `fastest` | ✗ | First success | Speed/latency |
| `priority` | ✗ | Provider order | Fallback chains |
| Custom | Depends | Your logic | Special requirements |

**Custom**
```ts
type QuoteSelectionFn = (
  quotes: Array<Promise<Quote>>
) => Promise<SuccessfulQuote | null>
```

## Returns

`Promise<SuccessfulQuote | null>`

A promise for a single quote that offers the best outcome depending on the strategy.
