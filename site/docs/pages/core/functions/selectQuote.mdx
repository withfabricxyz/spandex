# selectQuote

Pick the best simulated quote from a set of in-flight quote+simulation promises. This is useful when you want to stream quotes and simulations concurrently and only commit to the best result once enough data is available.

## Example

:::code-group

```ts [selectQuote]
import { prepareQuotes, selectQuote, simulateQuote } from "@withfabric/spandex";
import { config, client, swap } from "./config.ts";

const quotes = prepareQuotes({
  config,
  swap,
  mapFn: (quote) => simulateQuote({ quote, swap, client }),
});

const quote = await selectQuote({
  quotes,
  strategy: "quotedPrice",
});
```

:::

## Params

### quotes
`Array<Promise<SimulatedQuote>>`

A list of promises each resolving to a simulated quote. These can be created via the [`prepareQuotes`](./prepareQuotes.mdx) function.

### strategy
`QuoteSelectionStrategy`

Function that maps each fetched quote to a promise of type `T`. This allows for custom processing of each quote, such as simulation or other enrichment. Identity function is also valid.

| Strategy | Waits for All | Selection Criteria | Best For |
|----------|---------------|-------------------|----------|
| `quotedPrice` | ✓ | Highest simulated output | Price optimization |
| `quotedGas` | ✓ | Lowest simulated gas | Gas efficiency |
| `fastest` | ✗ | First success | Speed/latency |
| `priority` | ✗ | Provider order | Fallback chains |
| Custom | Depends | Your logic | Special requirements |

### sort
`SimulatedQuoteSort` (optional)

Comparator applied when the strategy waits for all simulated quotes (`quotedPrice` and `quotedGas`). Use [`resolveSuccessfulSimulatedQuotes`](./selectQuote.mdx#resolve-successful-quotes) if you also need the sorted results.

**Custom**
```ts
type QuoteSelectionFn = (
  quotes: Array<Promise<SimulatedQuote>>,
  context?: QuoteSelectionContext
) => Promise<SuccessfulSimulatedQuote | null>
```

## Returns

`Promise<SuccessfulSimulatedQuote | null>`

A promise for a single simulated quote that offers the best outcome depending on the strategy.

## Resolve successful quotes

```ts
import { resolveSuccessfulSimulatedQuotes } from "@withfabric/spandex";

const sorted = await resolveSuccessfulSimulatedQuotes({
  quotes,
  sort: (a, b) => (a.simulation.outputAmount > b.simulation.outputAmount ? 1 : -1),
});
```

Resolves every promise, filters to successful simulations, and optionally sorts them for reuse across custom selection flows.
